
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../cross/">
      
      
        <link rel="next" href="../clang/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.1, mkdocs-material-9.1.21">
    
    
      
        <title>Building Linux Image for Working with eBPF in QEMU - embARC Documentation Site</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#building-linux-image-for-working-with-ebpf-in-qemu" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="embARC Documentation Site" class="md-header__button md-logo" aria-label="embARC Documentation Site" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            embARC Documentation Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Building Linux Image for Working with eBPF in QEMU
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/foss-for-synopsys-dwc-arc-processors/toolchain" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GNU ARC Toolchain
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../simulators/qemu/" class="md-tabs__link">
        Simulators
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../baremetal/simulators/nsim/" class="md-tabs__link">
        Baremetal
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link md-tabs__link--active">
        Linux
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../platforms/" class="md-tabs__link">
        Boards
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../eclipse/" class="md-tabs__link">
        Eclipse IDE
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../audio/" class="md-tabs__link">
        Audio
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../ml/" class="md-tabs__link">
        Machine Learning
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../iot/" class="md-tabs__link">
        IoT
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../advanced/optimizations/" class="md-tabs__link">
        Advanced
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="embARC Documentation Site" class="md-nav__button md-logo" aria-label="embARC Documentation Site" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    embARC Documentation Site
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/foss-for-synopsys-dwc-arc-processors/toolchain" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GNU ARC Toolchain
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../..">Home</a>
          
            <label for="__nav_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../general/processors/" class="md-nav__link">
        Synopsys ARC Processors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../general/toolchains/" class="md-nav__link">
        Toolchains for ARC Processors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../general/target-options/" class="md-nav__link">
        Target Specific Options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../general/compatibility/" class="md-nav__link">
        Compatibility with MetaWare, nSIM and ARChitect
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        Frequently Asked Questions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Simulators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Simulators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../simulators/qemu/" class="md-nav__link">
        QEMU
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../simulators/nsim/" class="md-nav__link">
        nSIM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Baremetal
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Baremetal
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          Simulators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Simulators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/simulators/nsim/" class="md-nav__link">
        Building Applications and Debugging on nSIM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/simulators/qemu/" class="md-nav__link">
        Building Applications and Debugging on QEMU
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          Development platforms
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Development platforms
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/hardware/hsdk/" class="md-nav__link">
        HS Development Kit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/hardware/emsdp/" class="md-nav__link">
        EM Software Development Platform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/hardware/iotdk/" class="md-nav__link">
        IoT Development Kit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/hardware/emsk/" class="md-nav__link">
        🕥 EM Starter Kit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/hardware/axs-openocd/" class="md-nav__link">
        🕥 AXS with OpenOCD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/hardware/axs-ashling/" class="md-nav__link">
        🕥 AXS with Ashling Opella-XD
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          General Topics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          General Topics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/general/memory/" class="md-nav__link">
        Linker Scripts and Memory Maps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/general/specs/" class="md-nav__link">
        Specs Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/general/interrupts/" class="md-nav__link">
        Writing Interrupt Handlers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/general/heap-and-stack/" class="md-nav__link">
        Heap and Stack Size
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../baremetal/general/tcf/" class="md-nav__link">
        Using TCF
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">Linux</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Building Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Building Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../building/buildroot/" class="md-nav__link">
        Building Linux kernel with Filesystem Using Buildroot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../building/separate/" class="md-nav__link">
        Building Linux kernel and Filesystem Separately
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../building/configure/" class="md-nav__link">
        Configuring Buildroot and Linux Kernel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../building/toolchain/" class="md-nav__link">
        Using External Toolchains
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          Running Linux on simulators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Running Linux on simulators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/nsim/" class="md-nav__link">
        Building Linux for a Simulation and Running on nSIM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/metaware/" class="md-nav__link">
        Running Linux on nSIM Using MetaWare Debugger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/vdk/" class="md-nav__link">
        Running Linux on VDK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../simulators/qemu/" class="md-nav__link">
        Running Linux on QEMU
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          Running Linux on HS Development Kit
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Running Linux on HS Development Kit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hsdk/build/" class="md-nav__link">
        Building and running Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hsdk/uboot-build/" class="md-nav__link">
        Building U-Boot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hsdk/uboot-commands/" class="md-nav__link">
        U-Boot command reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
          Running Linux on AXS SDP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Running Linux on AXS SDP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../axs/build/" class="md-nav__link">
        Building and running Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../axs/uboot/" class="md-nav__link">
        Flashing U-Boot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" checked>
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
          Linux eBPF subsystem
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_6">
          <span class="md-nav__icon md-icon"></span>
          Linux eBPF subsystem
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cross/" class="md-nav__link">
        Cross-compiling eBPF Programs
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Building Linux Image for Working with eBPF in QEMU
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Building Linux Image for Working with eBPF in QEMU
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-linux-host" class="md-nav__link">
    Preparing Linux Host
  </a>
  
    <nav class="md-nav" aria-label="Preparing Linux Host">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notes-for-centos-7" class="md-nav__link">
    Notes for CentOS 7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-tools-and-libraries" class="md-nav__link">
    Preparing Tools and Libraries
  </a>
  
    <nav class="md-nav" aria-label="Preparing Tools and Libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-and-installing-elfutils" class="md-nav__link">
    Building and Installing elfutils
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-and-installing-pahole" class="md-nav__link">
    Building and Installing pahole
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-and-installing-bpftool" class="md-nav__link">
    Building and Installing bpftool
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-building-environment" class="md-nav__link">
    Preparing Building Environment
  </a>
  
    <nav class="md-nav" aria-label="Preparing Building Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloning-arc-ebpf-testbench" class="md-nav__link">
    Cloning ARC eBPF Testbench
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-buildroot" class="md-nav__link">
    Preparing Buildroot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-linux-sources" class="md-nav__link">
    Preparing Linux Sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-ssh-keys-for-users-authentication" class="md-nav__link">
    Installing SSH Keys for User's Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-ssh-keys-for-hosts-authentication-host-keys" class="md-nav__link">
    Install SSH Keys for Host's Authentication (Host Keys)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-images" class="md-nav__link">
    Building Images
  </a>
  
    <nav class="md-nav" aria-label="Building Images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-rootfscpio" class="md-nav__link">
    Building rootfs.cpio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-vmlinux" class="md-nav__link">
    Building vmlinux
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workarounds-for-well-known-pitfalls" class="md-nav__link">
    Workarounds for Well Known Pitfalls
  </a>
  
    <nav class="md-nav" aria-label="Workarounds for Well Known Pitfalls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#errors-while-building-kernels-ebpf-files" class="md-nav__link">
    Errors While Building Kernel's eBPF Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workaround-for-complex-float-error" class="md-nav__link">
    Workaround for complex float error
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-linux-image-using-qemu" class="md-nav__link">
    Running Linux Image Using QEMU
  </a>
  
    <nav class="md-nav" aria-label="Running Linux Image Using QEMU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-linux-using-user-level-network-interface" class="md-nav__link">
    Running Linux Using User Level Network Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-linux-using-tuntap-network-interface" class="md-nav__link">
    Running Linux Using TUN/TAP Network Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-linux" class="md-nav__link">
    Configuring Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-kernels-basic-ebpf-tests" class="md-nav__link">
    Running Kernel's Basic eBPF Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-and-running-ebpf-programs" class="md-nav__link">
    Building and Running eBPF Programs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-nfs-for-building-ebpf-programs-right-on-the-target" class="md-nav__link">
    Using NFS for Building eBPF Programs Right on the Target
  </a>
  
    <nav class="md-nav" aria-label="Using NFS for Building eBPF Programs Right on the Target">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-nfs-in-centos-7-or-fedora" class="md-nav__link">
    Configuring NFS in CentOS 7 or Fedora
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-nfs-in-ubuntu-1804" class="md-nav__link">
    Configuring NFS in Ubuntu 18.04
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-etcexports" class="md-nav__link">
    Configuring /etc/exports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mounting-nfs-directory-inside-the-guest" class="md-nav__link">
    Mounting NFS Directory Inside the Guest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-tools" class="md-nav__link">
    Preparing Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-ebpf-application" class="md-nav__link">
    Building a eBPF Application
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../clang/" class="md-nav__link">
        Building Clang with eBPF Target for ARC HS Hosts
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../platforms/">Boards</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Boards
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          Using Boards
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Using Boards
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/get-openocd/" class="md-nav__link">
        Getting OpenOCD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/use-openocd/" class="md-nav__link">
        Using OpenOCD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/mdb/" class="md-nav__link">
        Using MetaWare Debugger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/winusb/" class="md-nav__link">
        Installing WinUSB on Windows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/digilent/" class="md-nav__link">
        Installing Digilent Adept
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/reset/" class="md-nav__link">
        Resetting Boards
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
          Boards Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Boards Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/board-hsdk-4xd/" class="md-nav__link">
        ARC HS Development Kit 4xD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/board-hsdk/" class="md-nav__link">
        ARC HS Development Kit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/board-emsdp/" class="md-nav__link">
        ARC EM Software Development Platform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/board-iot/" class="md-nav__link">
        ARC IoT Development Kit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/board-emsk/" class="md-nav__link">
        ARC EM Starter Kit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/board-axs103/" class="md-nav__link">
        ARC AXS103 Software Development Platform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../platforms/board-axs101/" class="md-nav__link">
        ARC AXS101 Software Development Platform
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../eclipse/">Eclipse IDE</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Eclipse IDE
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../eclipse/installation/windows/" class="md-nav__link">
        Installing on Windows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../eclipse/installation/linux/" class="md-nav__link">
        Installing on Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../eclipse/installation/manual/" class="md-nav__link">
        Manual Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../eclipse/installation/preferences/" class="md-nav__link">
        Plugin Preferences
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../eclipse/getting-started/emsk/" class="md-nav__link">
        EM Starter Kit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../eclipse/getting-started/hsdk/" class="md-nav__link">
        HS Development Kit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../eclipse/getting-started/nsim/" class="md-nav__link">
        nSIM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          Other
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Other
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../eclipse/other/building/" class="md-nav__link">
        Building the Eclipse Plugin
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../audio/">Audio</a>
          
            <label for="__nav_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Audio
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          General
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          General
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../audio/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../audio/getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
          Codecs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          Codecs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../audio/codecs/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../audio/codec-bt-cvsd/" class="md-nav__link">
        BT-CVSD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../audio/codec-gsm-fr/" class="md-nav__link">
        GSM-FR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../audio/codec-g711/" class="md-nav__link">
        G.711
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../audio/codec-g722/" class="md-nav__link">
        G.722 (Appendix IV)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../audio/codec-g726/" class="md-nav__link">
        G.726
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../audio/codec-ldac/" class="md-nav__link">
        LDAC Encoder
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../ml/">Machine Learning</a>
          
            <label for="__nav_8">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Machine Learning
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ml/mli/" class="md-nav__link">
        embARC MLI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ml/caffe-framework/" class="md-nav__link">
        Caffe Framework for EV6x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ml/caffe-models/" class="md-nav__link">
        Caffe Models for EV6x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ml/opencv/" class="md-nav__link">
        OpenCV for EV6x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ml/gsl/" class="md-nav__link">
        GSL for EV6x
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../iot/">IoT</a>
          
            <label for="__nav_9">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          IoT
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../iot/embarc-osp/" class="md-nav__link">
        embARC OSP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../iot/embarc-bsp/" class="md-nav__link">
        embARC BSP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          Advanced
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Advanced
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_1" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_10_1" id="__nav_10_1_label" tabindex="0">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_1">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/optimizations/" class="md-nav__link">
        Optimization Options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/custom-instructions/" class="md-nav__link">
        Custom instructions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/apex-header/" class="md-nav__link">
        Migrating APEX Header
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/intrinsics/" class="md-nav__link">
        Intrinsics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/sanitizers/" class="md-nav__link">
        Sanitizers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/jli/" class="md-nav__link">
        JLI Instructions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/secure-shield/" class="md-nav__link">
        SecureShield Programming
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/small-data/" class="md-nav__link">
        Small Data Sections
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/64-bit-operations/" class="md-nav__link">
        Impact of 64-bit Integral Operation on GCC Toolchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../advanced/bit-file-fpga/" class="md-nav__link">
        Writing Bit-file into FPGA with Digilent HS Cable
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2" >
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_10_2" id="__nav_10_2_label" tabindex="0">
          Testing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10_2">
          <span class="md-nav__icon md-icon"></span>
          Testing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/dejagnu/" class="md-nav__link">
        Running DejaGNU Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/glibc/" class="md-nav__link">
        Running Glibc Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../testing/qemu/" class="md-nav__link">
        Running QEMU Tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-linux-host" class="md-nav__link">
    Preparing Linux Host
  </a>
  
    <nav class="md-nav" aria-label="Preparing Linux Host">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notes-for-centos-7" class="md-nav__link">
    Notes for CentOS 7
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-tools-and-libraries" class="md-nav__link">
    Preparing Tools and Libraries
  </a>
  
    <nav class="md-nav" aria-label="Preparing Tools and Libraries">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-and-installing-elfutils" class="md-nav__link">
    Building and Installing elfutils
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-and-installing-pahole" class="md-nav__link">
    Building and Installing pahole
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-and-installing-bpftool" class="md-nav__link">
    Building and Installing bpftool
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-building-environment" class="md-nav__link">
    Preparing Building Environment
  </a>
  
    <nav class="md-nav" aria-label="Preparing Building Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloning-arc-ebpf-testbench" class="md-nav__link">
    Cloning ARC eBPF Testbench
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-buildroot" class="md-nav__link">
    Preparing Buildroot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-linux-sources" class="md-nav__link">
    Preparing Linux Sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-ssh-keys-for-users-authentication" class="md-nav__link">
    Installing SSH Keys for User's Authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-ssh-keys-for-hosts-authentication-host-keys" class="md-nav__link">
    Install SSH Keys for Host's Authentication (Host Keys)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-images" class="md-nav__link">
    Building Images
  </a>
  
    <nav class="md-nav" aria-label="Building Images">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-rootfscpio" class="md-nav__link">
    Building rootfs.cpio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-vmlinux" class="md-nav__link">
    Building vmlinux
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workarounds-for-well-known-pitfalls" class="md-nav__link">
    Workarounds for Well Known Pitfalls
  </a>
  
    <nav class="md-nav" aria-label="Workarounds for Well Known Pitfalls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#errors-while-building-kernels-ebpf-files" class="md-nav__link">
    Errors While Building Kernel's eBPF Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workaround-for-complex-float-error" class="md-nav__link">
    Workaround for complex float error
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-linux-image-using-qemu" class="md-nav__link">
    Running Linux Image Using QEMU
  </a>
  
    <nav class="md-nav" aria-label="Running Linux Image Using QEMU">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-linux-using-user-level-network-interface" class="md-nav__link">
    Running Linux Using User Level Network Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-linux-using-tuntap-network-interface" class="md-nav__link">
    Running Linux Using TUN/TAP Network Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-linux" class="md-nav__link">
    Configuring Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-kernels-basic-ebpf-tests" class="md-nav__link">
    Running Kernel's Basic eBPF Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-and-running-ebpf-programs" class="md-nav__link">
    Building and Running eBPF Programs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-nfs-for-building-ebpf-programs-right-on-the-target" class="md-nav__link">
    Using NFS for Building eBPF Programs Right on the Target
  </a>
  
    <nav class="md-nav" aria-label="Using NFS for Building eBPF Programs Right on the Target">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-nfs-in-centos-7-or-fedora" class="md-nav__link">
    Configuring NFS in CentOS 7 or Fedora
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-nfs-in-ubuntu-1804" class="md-nav__link">
    Configuring NFS in Ubuntu 18.04
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-etcexports" class="md-nav__link">
    Configuring /etc/exports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mounting-nfs-directory-inside-the-guest" class="md-nav__link">
    Mounting NFS Directory Inside the Guest
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preparing-tools" class="md-nav__link">
    Preparing Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-a-ebpf-application" class="md-nav__link">
    Building a eBPF Application
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="building-linux-image-for-working-with-ebpf-in-qemu">Building Linux Image for Working with eBPF in QEMU<a class="headerlink" href="#building-linux-image-for-working-with-ebpf-in-qemu" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>This is a comprehensive guide about creating an environment for
building, running and debugging eBPF programs for ARC processors using
<a href="https://github.com/foss-for-synopsys-dwc-arc-processors/arc-gnu-toolchain">GNU toolchain</a>
and <a href="https://github.com/foss-for-synopsys-dwc-arc-processors/qemu">QEMU</a>.
Though we consider ARC HS 3x/4x on QEMU as a reference platform, the
same guide is applicable for boards like HS Development Kit.</p>
<p>This guide consists of these steps:</p>
<ol>
<li>Preparing your Linux host for building <code>rootfs</code> (Buildroot), Linux
   kernel, third-party tools and libraries.</li>
<li>Building and installing third-party tools and libraries: <code>elfutils</code>,
   <code>pahole</code> and <code>bpftool</code>. We are going to build them manually to
   ensure that the latest versions are used.</li>
<li>Preparing the building environment: cloning all necessary
   repositories, configuring SSH keys, etc.</li>
<li>Building <code>rootfs</code> (Buildroot) image and the Linux kernel.</li>
<li>Building and running eBPF programs.</li>
</ol>
<h2 id="preparing-linux-host">Preparing Linux Host<a class="headerlink" href="#preparing-linux-host" title="Permanent link">&para;</a></h2>
<p>We assume that toolchain directory for ARC HS 3x/4x is placed in
<code>/tools/arc-linux-gnu</code> (the directory which contains <code>bin</code>). Ensure that
<code>/tools/arc-linux-gnu/bin</code> is in <code>PATH</code> environment variable. We are
going to use <code>/tools</code> directory for installing tools and libraries. You
can use any other path, just do not forget to consider it while reading
this guide.</p>
<p>The latest release may be downloaded here ("Linux/glibc ARC HS" variant):</p>
<ul>
<li><a href="https://github.com/foss-for-synopsys-dwc-arc-processors/toolchain/releases">https://github.com/foss-for-synopsys-dwc-arc-processors/toolchain/releases</a></li>
</ul>
<p>Standard development tools must be installed on your host: <code>make</code>,
<code>cmake</code>, <code>git</code>, <code>rsync</code>, <code>gcc</code>, <code>binutils</code>, <code>clang</code> (for building eBPF
programs).</p>
<h3 id="notes-for-centos-7">Notes for CentOS 7<a class="headerlink" href="#notes-for-centos-7" title="Permanent link">&para;</a></h3>
<p>It is necessary to install the latest available development tools for
CentOS 7 to make it possible to build everything without problems. Use
<code>centos-release-scl</code> repository to install the latest tools and Git.
Then, have them enabled.</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>centos-release-scl
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>devtoolset-9<span class="w"> </span>rh-git227
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>scl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>devtoolset-9<span class="w"> </span>rh-git227<span class="w"> </span>bash
</span></code></pre></div>
<h2 id="preparing-tools-and-libraries">Preparing Tools and Libraries<a class="headerlink" href="#preparing-tools-and-libraries" title="Permanent link">&para;</a></h2>
<p>We are going to build and install some tools an libraries manually:</p>
<ol>
<li><code>pahole</code> host tool is used during the generation of BTF information
   for the Linux image. We have to use version ≤1.23 because later versions
   generate BTF information for 64-bit enumerations. However, the Linux
   kernel of version ≤6.0 contains tools which don't support such BTF
   records and building fails on the last stage. We need to ensure that a
   proper <code>pahole</code> is used.</li>
<li><code>elfutils</code> host libraries of version ≥0.189 must be presented in
   <code>LD_LIBRARY_PATH</code> because <code>pahole</code> relies on them for working with
   binaries. Support of ARCv2 was added in <code>elfutils</code> 0.189, thus we need
   to ensure that <code>pahole</code> is linked with recent-enough <code>elfutils</code>
   libraries.</li>
<li><code>bpftool</code> of version ≥7 must be used for building eBPF program which
   use features like <code>bpf_loop</code>, calls to another functions, etc. Older
   versions do not support new type of relocations for such features. If
   you are experiencing problems with host's <code>bpftool</code> (e.g., Ubuntu 22.04
   is shipped with an outdated <code>bpftool</code> which may fail while building the
   kernel) then it would be better to build and install it manually.</li>
</ol>
<h3 id="building-and-installing-elfutils">Building and Installing <code>elfutils</code><a class="headerlink" href="#building-and-installing-elfutils" title="Permanent link">&para;</a></h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Install dependencies for CentOS 7</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>libmicrohttpd<span class="w"> </span>libmicrohttpd-devel<span class="w"> </span>libsq3<span class="w"> </span>libsq3-devel<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">                 </span>libarchive<span class="w"> </span>libarchive-devel<span class="w"> </span>gettext-devel<span class="w"> </span>zstd<span class="w"> </span>libcurl-devel
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># Install dependencies for the latest Fedora</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>libmicrohttpd<span class="w"> </span>libmicrohttpd-devel<span class="w"> </span>libsq3<span class="w"> </span>libsq3-devel<span class="w"> </span><span class="se">\</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">                 </span>libarchive<span class="w"> </span>libarchive-devel<span class="w"> </span>gettext-devel
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c1"># Install dependencies for Ubuntu 18.04</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libmicrohttpd-dev<span class="w"> </span>libsqlite3-dev<span class="w"> </span>libarchive-dev
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="c1"># Clone, configure and build elfutils (use your own prefix instead of /tools/elfutils)</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>elfutils-0.189<span class="w"> </span>https://sourceware.org/git/elfutils.git
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="nb">cd</span><span class="w"> </span>elfutils
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>autoreconf<span class="w"> </span>-fi
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>mkdir<span class="w"> </span>build
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="nb">cd</span><span class="w"> </span>build
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>../configure<span class="w"> </span>--prefix<span class="o">=</span>/tools/elfutils<span class="w"> </span>--enable-maintainer-mode
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>make
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>make<span class="w"> </span>install
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="c1"># Configure your environment</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/tools/elfutils/bin:<span class="nv">$PATH</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/tools/elfutils/lib<span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="p">:+:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="si">}</span>
</span></code></pre></div>
<h3 id="building-and-installing-pahole">Building and Installing <code>pahole</code><a class="headerlink" href="#building-and-installing-pahole" title="Permanent link">&para;</a></h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Clone, configure and build pahole (use your own prefix instead of /tools/pahole)</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>v1.23<span class="w"> </span>https://git.kernel.org/pub/scm/devel/pahole/pahole.git
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>mkdir<span class="w"> </span>pahole/build
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="nb">cd</span><span class="w"> </span>pahole/build
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>cmake<span class="w"> </span>-G<span class="w"> </span><span class="s2">&quot;Unix Makefiles&quot;</span><span class="w">                              </span><span class="se">\</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">      </span>-D__LIB<span class="o">=</span>lib<span class="w">                                      </span><span class="se">\</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">      </span>-DDWARF_INCLUDE_DIR<span class="o">=</span>/tools/elfutils/include<span class="w">      </span><span class="se">\</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">      </span>-DLIBDW_INCLUDE_DIR<span class="o">=</span>/tools/elfutils/include<span class="w">      </span><span class="se">\</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">      </span>-DDWARF_LIBRARY<span class="o">=</span>/tools/elfutils/lib/libdw.so.1<span class="w">   </span><span class="se">\</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">      </span>-DELF_LIBRARY<span class="o">=</span>/tools/elfutils/lib/libelf.so.1<span class="w">    </span><span class="se">\</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">      </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/tools/pahole<span class="w">             </span><span class="se">\</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">      </span>..
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>make<span class="w"> </span>install
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="c1"># Configure your environment</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/tools/pahole/bin:<span class="nv">$PATH</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/tools/pahole/lib<span class="si">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="p">:+:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="si">}</span>
</span></code></pre></div>
<h3 id="building-and-installing-bpftool">Building and Installing <code>bpftool</code><a class="headerlink" href="#building-and-installing-bpftool" title="Permanent link">&para;</a></h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Clone and build bpftool (use your own prefix instead of /tools/bpftool)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>git<span class="w"> </span>clone<span class="w"> </span>--recurse-submodules<span class="w"> </span>https://github.com/libbpf/bpftool.git
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nb">cd</span><span class="w"> </span>bpftool/src
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>make<span class="w"> </span><span class="nv">prefix</span><span class="o">=</span>/tools/bpftool<span class="w"> </span><span class="nv">EXTRA_CFLAGS</span><span class="o">=</span><span class="s2">&quot;-I/tools/elfutils/include&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">                           </span><span class="nv">EXTRA_LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-L/tools/elfutils/lib&quot;</span><span class="w">    </span><span class="se">\</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">                           </span>install-bin
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="c1"># Configure your environment</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/tools/bpftool/sbin/:<span class="nv">$PATH</span>
</span></code></pre></div>
<h2 id="preparing-building-environment">Preparing Building Environment<a class="headerlink" href="#preparing-building-environment" title="Permanent link">&para;</a></h2>
<h3 id="cloning-arc-ebpf-testbench">Cloning ARC eBPF Testbench<a class="headerlink" href="#cloning-arc-ebpf-testbench" title="Permanent link">&para;</a></h3>
<p>Clone ARC eBPF testbench. This repository contains configuration files
for Buildroot and Linux kernel which simplify setup of the environment
for working with eBPF. We are going to use it as a working directory.</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>git<span class="w"> </span>clone<span class="w"> </span>--recurse-submodules<span class="w"> </span>https://github.com/foss-for-synopsys-dwc-arc-processors/arc-bpf-testbench
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nb">cd</span><span class="w"> </span>arc-bpf-testbench
</span></code></pre></div>
<h3 id="preparing-buildroot">Preparing Buildroot<a class="headerlink" href="#preparing-buildroot" title="Permanent link">&para;</a></h3>
<p>Clone Buildroot, create a build directory and copy all necessary
configuration files and an overlay to the build directory from
<code>arc-bpf-testbench/extras</code>:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://git.buildroot.net/buildroot
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>mkdir<span class="w"> </span>buildroot/build
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>cp<span class="w"> </span>-r<span class="w"> </span>extras/buildroot/*<span class="w"> </span>buildroot/build
</span></code></pre></div>
<p>List of copied files and directories:</p>
<ol>
<li><code>busybox.fragment</code> - A configuration file for BusyBox.</li>
<li><code>device_table.txt</code> - A configuration file fo setting proper
   permissions for files in the overlay.</li>
<li><code>qemu_hs4x_ebpf_defconfig</code> - A configuration file for Buildroot.</li>
<li><code>overlay</code> - All necessary additional files for target's file system
   (configuration files, testing SSH keys, etc.).</li>
</ol>
<p>It's assumed here that the root directory for the toolchain is
<code>/tools/arc-linux-gnu</code>. Thus you need to change
<code>BR2_TOOLCHAIN_EXTERNAL_PATH</code> in <code>qemu_hs4x_ebpf_defconfig</code>
configuration file for Buildroot to the corresponding path.</p>
<h3 id="preparing-linux-sources">Preparing Linux Sources<a class="headerlink" href="#preparing-linux-sources" title="Permanent link">&para;</a></h3>
<p>Clone repository of the Linux kernel with the latest patches for support
of eBPF with JIT and copy a corresponding configuration file:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>bpf-early-access<span class="w"> </span>https://github.com/foss-for-synopsys-dwc-arc-processors/linux
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>mkdir<span class="w"> </span>linux/build
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>cp<span class="w"> </span>extras/linux/qemu_hs4x_ebpf_defconfig<span class="w"> </span>linux/arch/arc/configs
</span></code></pre></div>
<h3 id="installing-ssh-keys-for-users-authentication">Installing SSH Keys for User's Authentication<a class="headerlink" href="#installing-ssh-keys-for-users-authentication" title="Permanent link">&para;</a></h3>
<p>We are going to use SSH for interacting with the ARC Linux system. It
would be helpful to have keys for public key authorization without using
a password.</p>
<p>You can copy the pregenerated keys from <code>extras/host/.ssh/keys</code> to the
corresponding host's directory <code>~/.ssh/keys</code>. Public key for this pair
of keys is already installed in the <code>buildroot/build/overlay/root/.ssh</code>
directory. Don't forget to apply proper rights for those keys in <code>.ssh</code>
for your host (600).</p>
<p>Configure your SSH hosts in <code>~/.ssh/config</code> (you also can find this file
in <code>extras/host/.ssh/config</code>):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>Host arc
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    HostName            127.0.0.1
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    Port                2022
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    User                root
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    IdentityFile        ~/.ssh/keys/arc
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>Host arc-tap
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    HostName            10.42.0.100
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    Port                22
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    User                root
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    IdentityFile        ~/.ssh/keys/arc
</span></code></pre></div>
<p>Also, you can generate your own keys (use your own home path):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>$ mkdir -p ~/.ssh/keys
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>$ ssh-keygen -t rsa -C &quot;arc@ebpf&quot;
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>Generating public/private rsa key pair.
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="hll">Enter file in which to save the key (/home/user/.ssh/id_rsa): /home/user/.ssh/keys/arc
</span></span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>Enter passphrase (empty for no passphrase):
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>Enter same passphrase again:
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>Your identification has been saved in /home/user/.ssh/keys/arc
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>Your public key has been saved in /home/user/.ssh/keys/arc.pub
</span></code></pre></div>
<p>Add your public key to the overlay directory:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>buildroot/build/overlay/root/.ssh
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>cp<span class="w"> </span>-f<span class="w"> </span>~/.ssh/keys/arc.pub<span class="w"> </span>buildroot/build/overlay/root/.ssh/authorized_keys
</span></code></pre></div>
<h3 id="install-ssh-keys-for-hosts-authentication-host-keys">Install SSH Keys for Host's Authentication (Host Keys)<a class="headerlink" href="#install-ssh-keys-for-hosts-authentication-host-keys" title="Permanent link">&para;</a></h3>
<p>By default, Linux with SSH daemon installed generates random host keys
if they don't exist. For testing and debugging purposes using QEMU it
may lead to these difficulties:</p>
<ol>
<li>Generating a set of host keys in QEMU may take a lot of time.</li>
<li>Each time you run QEMU with <code>vmlinux</code> image new keys a generated.
   Thus, you have to clear cached host key for the QEMU instance to
   avoid complaining about the changed target's host key.</li>
</ol>
<p>Overlay already contains pregenerated host keys. However, you can
generate your own keys:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>ssh-keygen<span class="w"> </span>-A<span class="w"> </span>-f<span class="w"> </span>buildroot/build/overlay
</span></code></pre></div>
<h2 id="building-images">Building Images<a class="headerlink" href="#building-images" title="Permanent link">&para;</a></h2>
<h3 id="building-rootfscpio">Building <code>rootfs.cpio</code><a class="headerlink" href="#building-rootfscpio" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Buildroot requires Git of version 2+. Some old systems (e.g., CentOS 7)
have an outdated Git which is not supported by Buildroot's build
system. If you face this problem then you have to find a way to install
newer version of Git (e.g., using third-party repositories).</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>SSHFS package requires <code>docutils</code> module for Python. Install it using
your package manager or using <code>pip</code> (<code>pip install docutils</code>) or delete
the <code>BR2_PACKAGE_SSHFS=y</code> line if you aren't going to use SSHFS.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Buildroot may complain about invalid headers' version for the
toolchain: <code>Incorrect selection of kernel headers: expected 5.16.x, got 5.18.x</code>
E.g., <code>2022.09</code> release is shipped with headers for Linux kernel 5.16.x.
If it's not your case then manually change headers' versions for the
toolchain using <code>make menuconfig</code>.</p>
</div>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nb">cd</span><span class="w"> </span>buildroot/build
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>make<span class="w"> </span>-C<span class="w"> </span>..<span class="w"> </span><span class="nv">O</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="w"> </span>defconfig<span class="w"> </span><span class="nv">BR2_DEFCONFIG</span><span class="o">=</span>build/qemu_hs4x_ebpf_defconfig
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>make<span class="w"> </span>-j<span class="w"> </span><span class="k">$(</span>nproc<span class="k">)</span>
</span></code></pre></div>
<h3 id="building-vmlinux">Building <code>vmlinux</code><a class="headerlink" href="#building-vmlinux" title="Permanent link">&para;</a></h3>
<p>Set necessary environment variables and build the kernel:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">cd</span><span class="w"> </span>../../linux/build
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span>arc
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CROSS_COMPILE</span><span class="o">=</span>arc-linux-gnu-
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">C_INCLUDE_PATH</span><span class="o">=</span><span class="s2">&quot;/tools/elfutils/include&quot;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;/tools/elfutils/lib&quot;</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>make<span class="w"> </span>-C<span class="w"> </span>..<span class="w"> </span><span class="nv">O</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="w"> </span>qemu_hs4x_ebpf_defconfig
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>make<span class="w"> </span>-j<span class="w"> </span><span class="k">$(</span>nproc<span class="k">)</span>
</span></code></pre></div>
<h2 id="workarounds-for-well-known-pitfalls">Workarounds for Well Known Pitfalls<a class="headerlink" href="#workarounds-for-well-known-pitfalls" title="Permanent link">&para;</a></h2>
<h3 id="errors-while-building-kernels-ebpf-files">Errors While Building Kernel's eBPF Files<a class="headerlink" href="#errors-while-building-kernels-ebpf-files" title="Permanent link">&para;</a></h3>
<p>Change <code>kernel/bpf/Makefile</code> to prevent some build errors:</p>
<div class="language-diff highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="gh">diff --git a/kernel/bpf/Makefile b/kernel/bpf/Makefile</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="gh">index ae90af5b0425..4699a022079a 100644</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="gd">--- a/kernel/bpf/Makefile</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="gi">+++ b/kernel/bpf/Makefile</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="gu">@@ -4,7 +4,7 @@ ifneq ($(CONFIG_BPF_JIT_ALWAYS_ON),y)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a># ___bpf_prog_run() needs GCSE disabled on x86; see 3193c0836f203 for details
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>cflags-nogcse-$(CONFIG_X86)$(CONFIG_CC_IS_GCC) := -fno-gcse
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>endif
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="gd">-CFLAGS_core.o += $(call cc-disable-warning, override-init) $(cflags-nogcse-yy) -Og -g3</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="gi">+CFLAGS_core.o += $(call cc-disable-warning, override-init) $(cflags-nogcse-yy) -Og -g3 -finline-functions-called-once</span>
</span></code></pre></div>
<h3 id="workaround-for-complex-float-error">Workaround for <code>complex float</code> error<a class="headerlink" href="#workaround-for-complex-float-error" title="Permanent link">&para;</a></h3>
<p>Toolchains for ARC generate <code>complex float</code> DIE entries in <code>libgcc</code>. At
the moment such entries are not supported by <code>pahole</code>. So, it's
necessary to disable generating BTF for floats. It's already done in
<code>bpf-early-access</code> branch but if you want to build the Linux kernel from
another branch or repository with BTF information you can apply
<a href="https://github.com/foss-for-synopsys-dwc-arc-processors/linux/commit/b17d1955b67493afe37430694c8982411336fc4c">this patch</a>:</p>
<div class="language-diff highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="gh">diff --git a/scripts/pahole-flags.sh b/scripts/pahole-flags.sh</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="gh">index 0d99ef17e4a5..23af14c6ef94 100755</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="gd">--- a/scripts/pahole-flags.sh</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="gi">+++ b/scripts/pahole-flags.sh</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="gu">@@ -14,7 +14,7 @@ if [ &quot;${pahole_ver}&quot; -ge &quot;118&quot; ] &amp;&amp; [ &quot;${pahole_ver}&quot; -le &quot;121&quot; ]; then</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w"> </span>       extra_paholeopt=&quot;${extra_paholeopt} --skip_encoding_btf_vars&quot;
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>fi
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>if [ &quot;${pahole_ver}&quot; -ge &quot;121&quot; ]; then
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="gd">-       extra_paholeopt=&quot;${extra_paholeopt} --btf_gen_floats&quot;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="gi">+       extra_paholeopt=&quot;${extra_paholeopt}&quot;</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>fi
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>if [ &quot;${pahole_ver}&quot; -ge &quot;122&quot; ]; then
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w"> </span>       extra_paholeopt=&quot;${extra_paholeopt} -j&quot;
</span></code></pre></div>
<h2 id="running-linux-image-using-qemu">Running Linux Image Using QEMU<a class="headerlink" href="#running-linux-image-using-qemu" title="Permanent link">&para;</a></h2>
<p>All actions mentioned below are performed from the working directory
(root of <code>arc-bpf-testbench</code>).</p>
<h3 id="running-linux-using-user-level-network-interface">Running Linux Using User Level Network Interface<a class="headerlink" href="#running-linux-using-user-level-network-interface" title="Permanent link">&para;</a></h3>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>make<span class="w"> </span>qemu-start
</span></code></pre></div>
<h3 id="running-linux-using-tuntap-network-interface">Running Linux Using TUN/TAP Network Interface<a class="headerlink" href="#running-linux-using-tuntap-network-interface" title="Permanent link">&para;</a></h3>
<p>TUN/TAP network interface allows interacting of the target with your
host in both directions. For example, you can mount host's NFS
directories inside of the target. Configure TUN/TAP interface on host's
side:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Manually</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>sudo<span class="w"> </span>ip<span class="w"> </span>tuntap<span class="w"> </span>add<span class="w"> </span>tap1<span class="w"> </span>mode<span class="w"> </span>tap
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>sudo<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">10</span>.42.0.1/24<span class="w"> </span>dev<span class="w"> </span>tap1
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>tap1<span class="w"> </span>up
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="c1"># ... or using testbench</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>sudo<span class="w"> </span>make<span class="w"> </span>tap
</span></code></pre></div>
<p>Then run <code>vmlinux</code>:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>make<span class="w"> </span><span class="nv">USE_TAP</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>qemu-start
</span></code></pre></div>
<p>Configure a network interface on target's side:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>ifconfig<span class="w"> </span>eth0<span class="w"> </span><span class="m">10</span>.42.0.100
</span></code></pre></div>
<h3 id="configuring-linux">Configuring Linux<a class="headerlink" href="#configuring-linux" title="Permanent link">&para;</a></h3>
<p>Mount <code>debugfs</code> and turn JIT on:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># On host&#39;s side</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>ssh<span class="w"> </span>arc<span class="w"> </span><span class="s2">&quot;mount -t debugfs debugfs /sys/kernel/debug&quot;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>ssh<span class="w"> </span>arc<span class="w"> </span><span class="s2">&quot;sysctl net.core.bpf_jit_enable=1&quot;</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="c1"># ... or on target&#39;s side</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>mount<span class="w"> </span>-t<span class="w"> </span>debugfs<span class="w"> </span>debugfs<span class="w"> </span>/sys/kernel/debug
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>sysctl<span class="w"> </span>net.core.bpf_jit_enable<span class="o">=</span><span class="m">1</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="c1"># ... or using testbench for user level network interface</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>make<span class="w"> </span>qemu-setup
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="c1"># ... or using testbench for tun/tap network interface</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>make<span class="w"> </span><span class="nv">USE_TAP</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>qemu-setup
</span></code></pre></div>
<h3 id="running-kernels-basic-ebpf-tests">Running Kernel's Basic eBPF Tests<a class="headerlink" href="#running-kernels-basic-ebpf-tests" title="Permanent link">&para;</a></h3>
<p>Send a module for testing to the target:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># For user level network interface</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>rsync<span class="w"> </span>linux/build/lib/test_bpf.ko<span class="w"> </span>arc:/root
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c1"># For TUN/TAP network interface</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>rsync<span class="w"> </span>linux/build/lib/test_bpf.ko<span class="w"> </span>arc-tap:/root
</span></code></pre></div>
<p>Run the module on the target:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># Run all tests</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>insmod<span class="w"> </span>test_bpf.ko
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c1"># Run a specific</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>insmod<span class="w"> </span>test_bpf.ko<span class="w"> </span><span class="nv">test_id</span><span class="o">=</span><span class="m">42</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="c1"># Run a range of tests</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>insmod<span class="w"> </span>test_bpf.ko<span class="w"> </span><span class="nv">test_range</span><span class="o">=</span><span class="m">42</span>,142
</span></code></pre></div>
<h2 id="building-and-running-ebpf-programs">Building and Running eBPF Programs<a class="headerlink" href="#building-and-running-ebpf-programs" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Old operating systems like CentOS 7 and Ubuntu 18.04 contain old
versions of <code>clang</code> which may not be sufficient for building modern eBPF
programs. If building eBPF programs fails then try to build the latest
<code>clang</code> with eBPF target following <a href="../clang/">a corresponding guide</a>
and put it into <code>PATH</code>.</p>
</div>
<p>Testbench contains a bunch of examples of eBPF programs. You can build
and load them using these commands from the root directory of the
testbench:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># Build dependencies</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>make
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="c1"># Load programs for user level network interface</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>make<span class="w"> </span>qemu-load
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="c1"># or for TUN/TAP network interface</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>make<span class="w"> </span><span class="nv">USE_TAP</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>qemu-load
</span></code></pre></div>
<p>Run a program:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># Manually on target&#39;s side</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>./minimal
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="c1"># ... or using testbench on host&#39;s side</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>make<span class="w"> </span>run-minimal
</span></code></pre></div>
<p>Explore <code>README.md</code> for <a href="https://github.com/foss-for-synopsys-dwc-arc-processors/arc-bpf-testbench">ARC eBPF Testbench</a>
or run <code>make help</code> for information about available commands.</p>
<h2 id="using-nfs-for-building-ebpf-programs-right-on-the-target">Using NFS for Building eBPF Programs Right on the Target<a class="headerlink" href="#using-nfs-for-building-ebpf-programs-right-on-the-target" title="Permanent link">&para;</a></h2>
<h3 id="configuring-nfs-in-centos-7-or-fedora">Configuring NFS in CentOS 7 or Fedora<a class="headerlink" href="#configuring-nfs-in-centos-7-or-fedora" title="Permanent link">&para;</a></h3>
<p>Install NFS to the host:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># For CentOS 7</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>nfs-utils
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="c1"># For Fedora</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>nfs-utils
</span></code></pre></div>
<p>Enable services and add rules for firewall:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>rpcbind<span class="w"> </span>nfs-server
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--add-service<span class="o">=</span>nfs<span class="w"> </span>--permanent
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="c1"># Optional (only if you are going to use SSHFS instead of NFS)</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>sshd
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>sshd
</span></code></pre></div>
<h3 id="configuring-nfs-in-ubuntu-1804">Configuring NFS in Ubuntu 18.04<a class="headerlink" href="#configuring-nfs-in-ubuntu-1804" title="Permanent link">&para;</a></h3>
<p>Install NFS to the host and enable it:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nfs-kernel-server
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>nfs-server
</span></code></pre></div>
<h3 id="configuring-etcexports">Configuring <code>/etc/exports</code><a class="headerlink" href="#configuring-etcexports" title="Permanent link">&para;</a></h3>
<p>Add this line to <code>/etc/exports</code> (you can find <code>anonuid</code> and <code>anongid</code>
for your user using <code>id -u</code> and <code>id -g</code> respectively):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>/nfs *(rw,all_squash,anonuid=1000,anongid=1000,no_subtree_check,insecure)
</span></code></pre></div>
<p>Update the table of exported NFS file systems:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>sudo<span class="w"> </span>exportfs<span class="w"> </span>-rv
</span></code></pre></div>
<h3 id="mounting-nfs-directory-inside-the-guest">Mounting NFS Directory Inside the Guest<a class="headerlink" href="#mounting-nfs-directory-inside-the-guest" title="Permanent link">&para;</a></h3>
<p>Create a directory for mounting NFS directory on target's side:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>mkdir<span class="w"> </span>/nfs
</span></code></pre></div>
<p>If you use user level network interface for running QEMU then just run
these commands inside the guest:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Using NFS</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>mount<span class="w"> </span>-t<span class="w"> </span>nfs<span class="w"> </span><span class="m">10</span>.0.2.2:/nfs<span class="w"> </span>/nfs<span class="w"> </span>-o<span class="w"> </span>nolock
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="c1"># Using SSHFS</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>sshfs<span class="w"> </span>-o<span class="w"> </span><span class="nv">idmap</span><span class="o">=</span>user,allow_other<span class="w"> </span>user@10.0.2.2:/nfs<span class="w"> </span>/nfs
</span></code></pre></div>
<p>If you prefer using TUN/TAP network interface, then run QEMU like
<code>make USE_TAP=1 qemu-start</code> and configure guest's network interface as
mentioned earlier. Then run this line on target's side:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Using NFS</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>mount<span class="w"> </span>-t<span class="w"> </span>nfs<span class="w"> </span><span class="m">10</span>.42.0.1:/nfs<span class="w"> </span>/nfs<span class="w"> </span>-o<span class="w"> </span>nolock
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="c1"># Using SSHFS</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>sshfs<span class="w"> </span>-o<span class="w"> </span><span class="nv">idmap</span><span class="o">=</span>user,allow_other<span class="w"> </span>user@10.42.0.1:/nfs<span class="w"> </span>/nfs
</span></code></pre></div>
<h3 id="preparing-tools">Preparing Tools<a class="headerlink" href="#preparing-tools" title="Permanent link">&para;</a></h3>
<p><a href="../clang/">Build Clang for ARC</a> and place a directory with <code>clang</code> to <code>/nfs</code>
(the full path to Clang root directory must be <code>/nfs/clang</code>).</p>
<p>Download, unpack and place a native glibc ARC HS
<a href="https://github.com/foss-for-synopsys-dwc-arc-processors/toolchain/releases">toolchain</a>
into <code>/nfs/arc-linux-gnu</code>.</p>
<p>Copy <code>/tools/arc-linux-gnu/sysroot</code> to <code>/nfs/sysroot</code>. Also build
applications using testbench (run <code>make</code> from the root directory of the
testbench) and copy headers to the sysroot:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>cp<span class="w"> </span>-r<span class="w"> </span>output/arc/deps/include/*<span class="w"> </span>/nfs/sysroot/usr/include/
</span></code></pre></div>
<p>Copy applications from the testbench:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>cp<span class="w"> </span>-r<span class="w"> </span>apps<span class="w"> </span>/nfs
</span></code></pre></div>
<h3 id="building-a-ebpf-application">Building a eBPF Application<a class="headerlink" href="#building-a-ebpf-application" title="Permanent link">&para;</a></h3>
<p>Use these commands inside the ARC guest (QEMU):</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Configure your PATH</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/nfs/clang/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/nfs/arc-linux-gnu/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="c1"># Build &quot;minimal&quot;</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="nb">cd</span><span class="w"> </span>/nfs/apps
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>clang<span class="w"> </span>-g<span class="w">                         </span><span class="se">\</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">      </span>-O2<span class="w">                        </span><span class="se">\</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">      </span>-target<span class="w"> </span>bpf<span class="w">                </span><span class="se">\</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">      </span>-D__TARGET_ARCH_arc<span class="w">        </span><span class="se">\</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">      </span>-I/nfs/sysroot/usr/include<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">      </span>-c<span class="w"> </span>minimal.bpf.c<span class="w">           </span><span class="se">\</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">      </span>-o<span class="w"> </span>minimal.bpf.o
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>bpftool<span class="w"> </span>gen<span class="w"> </span>skeleton<span class="w"> </span>minimal.bpf.o<span class="w"> </span>&gt;<span class="w"> </span>minimal.skel.h
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>gcc<span class="w"> </span>-I/nfs/sysroot/usr/include<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">    </span>-L/usr/lib<span class="w"> </span>minimal.c<span class="w">       </span><span class="se">\</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="w">    </span>-lbpf<span class="w">                      </span><span class="se">\</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w">    </span>-lelf<span class="w">                      </span><span class="se">\</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w">    </span>-lz<span class="w">                        </span><span class="se">\</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="w">    </span>-o<span class="w"> </span>minimal
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="c1"># Prepare the Linux kernel</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a>mount<span class="w"> </span>-t<span class="w"> </span>debugfs<span class="w"> </span>debugfs<span class="w"> </span>/sys/kernel/debug
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>sysctl<span class="w"> </span>net.core.bpf_jit_enable<span class="o">=</span><span class="m">1</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="c1"># Run the application</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a>./minimal
</span></code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2023 Synopsys
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.path", "navigation.sections", "navigation.indexes", "navigation.top", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>